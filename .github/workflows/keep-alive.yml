# GitHub Actions Workflow - Keep Alive
# MantÃ©m a aplicaÃ§Ã£o Streamlit Cloud ativa, evitando sleep mode
# Executa a cada 12 horas para fazer ping na aplicaÃ§Ã£o

name: ğŸŸ¢ Keep Alive - AgroPulse

on:
  # Executa automaticamente a cada 12 horas
  schedule:
    - cron: '0 */12 * * *'  # A cada 12 horas (00:00 e 12:00 UTC)
  
  # Permite execuÃ§Ã£o manual via GitHub Actions
  workflow_dispatch:

jobs:
  keep-alive:
    name: ğŸ“¡ Ping AgroPulse
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ”” Ping aplicaÃ§Ã£o Streamlit
        run: |
          echo "ğŸš€ Fazendo ping em agropulse.streamlit.app..."
          
          # Faz requisiÃ§Ã£o HTTP para manter a aplicaÃ§Ã£o ativa
          response=$(curl -s -o /dev/null -w "%{http_code}" https://agropulse.streamlit.app)
          
          echo "ğŸ“Š Status HTTP: $response"
          
          if [ "$response" -eq 200 ] || [ "$response" -eq 302 ]; then
            echo "âœ… AplicaÃ§Ã£o estÃ¡ ativa e respondendo!"
          else
            echo "âš ï¸ AplicaÃ§Ã£o retornou status $response - pode estar inicializando"
          fi
          
          # Aguarda alguns segundos para garantir que a app carregue
          sleep 10
          
          # Segunda verificaÃ§Ã£o
          response2=$(curl -s -o /dev/null -w "%{http_code}" https://agropulse.streamlit.app)
          echo "ğŸ“Š Segunda verificaÃ§Ã£o - Status HTTP: $response2"
          
          if [ "$response2" -eq 200 ] || [ "$response2" -eq 302 ]; then
            echo "âœ… AgroPulse Media Watch estÃ¡ online!"
          fi

      - name: ğŸ“ Log de execuÃ§Ã£o
        run: |
          echo "================================================"
          echo "ğŸ• HorÃ¡rio UTC: $(date -u)"
          echo "ğŸŒ AplicaÃ§Ã£o: https://agropulse.streamlit.app"
          echo "ğŸ“¡ PrÃ³ximo ping em 12 horas"
          echo "================================================"
